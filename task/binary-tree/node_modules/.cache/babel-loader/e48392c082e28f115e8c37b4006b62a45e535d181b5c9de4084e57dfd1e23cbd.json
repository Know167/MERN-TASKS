{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compareTopologyVersion = exports.parseServerType = exports.ServerDescription = void 0;\nconst bson_1 = require(\"../bson\");\nconst utils_1 = require(\"../utils\");\nconst common_1 = require(\"./common\");\nconst WRITABLE_SERVER_TYPES = new Set([common_1.ServerType.RSPrimary, common_1.ServerType.Standalone, common_1.ServerType.Mongos, common_1.ServerType.LoadBalancer]);\nconst DATA_BEARING_SERVER_TYPES = new Set([common_1.ServerType.RSPrimary, common_1.ServerType.RSSecondary, common_1.ServerType.Mongos, common_1.ServerType.Standalone, common_1.ServerType.LoadBalancer]);\n/**\n * The client's view of a single server, based on the most recent hello outcome.\n *\n * Internal type, not meant to be directly instantiated\n * @public\n */\nclass ServerDescription {\n  /**\n   * Create a ServerDescription\n   * @internal\n   *\n   * @param address - The address of the server\n   * @param hello - An optional hello response for this server\n   */\n  constructor(address, hello, options) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n    if (typeof address === 'string') {\n      this._hostAddress = new utils_1.HostAddress(address);\n      this.address = this._hostAddress.toString();\n    } else {\n      this._hostAddress = address;\n      this.address = this._hostAddress.toString();\n    }\n    this.type = parseServerType(hello, options);\n    this.hosts = (_b = (_a = hello === null || hello === void 0 ? void 0 : hello.hosts) === null || _a === void 0 ? void 0 : _a.map(host => host.toLowerCase())) !== null && _b !== void 0 ? _b : [];\n    this.passives = (_d = (_c = hello === null || hello === void 0 ? void 0 : hello.passives) === null || _c === void 0 ? void 0 : _c.map(host => host.toLowerCase())) !== null && _d !== void 0 ? _d : [];\n    this.arbiters = (_f = (_e = hello === null || hello === void 0 ? void 0 : hello.arbiters) === null || _e === void 0 ? void 0 : _e.map(host => host.toLowerCase())) !== null && _f !== void 0 ? _f : [];\n    this.tags = (_g = hello === null || hello === void 0 ? void 0 : hello.tags) !== null && _g !== void 0 ? _g : {};\n    this.minWireVersion = (_h = hello === null || hello === void 0 ? void 0 : hello.minWireVersion) !== null && _h !== void 0 ? _h : 0;\n    this.maxWireVersion = (_j = hello === null || hello === void 0 ? void 0 : hello.maxWireVersion) !== null && _j !== void 0 ? _j : 0;\n    this.roundTripTime = (_k = options === null || options === void 0 ? void 0 : options.roundTripTime) !== null && _k !== void 0 ? _k : -1;\n    this.lastUpdateTime = (0, utils_1.now)();\n    this.lastWriteDate = (_m = (_l = hello === null || hello === void 0 ? void 0 : hello.lastWrite) === null || _l === void 0 ? void 0 : _l.lastWriteDate) !== null && _m !== void 0 ? _m : 0;\n    if (options === null || options === void 0 ? void 0 : options.topologyVersion) {\n      this.topologyVersion = options.topologyVersion;\n    } else if (hello === null || hello === void 0 ? void 0 : hello.topologyVersion) {\n      this.topologyVersion = hello.topologyVersion;\n    }\n    if (options === null || options === void 0 ? void 0 : options.error) {\n      this.error = options.error;\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.primary) {\n      this.primary = hello.primary;\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.me) {\n      this.me = hello.me.toLowerCase();\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.setName) {\n      this.setName = hello.setName;\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.setVersion) {\n      this.setVersion = hello.setVersion;\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.electionId) {\n      this.electionId = hello.electionId;\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.logicalSessionTimeoutMinutes) {\n      this.logicalSessionTimeoutMinutes = hello.logicalSessionTimeoutMinutes;\n    }\n    if (hello === null || hello === void 0 ? void 0 : hello.$clusterTime) {\n      this.$clusterTime = hello.$clusterTime;\n    }\n  }\n  get hostAddress() {\n    if (this._hostAddress) return this._hostAddress;else return new utils_1.HostAddress(this.address);\n  }\n  get allHosts() {\n    return this.hosts.concat(this.arbiters).concat(this.passives);\n  }\n  /** Is this server available for reads*/\n  get isReadable() {\n    return this.type === common_1.ServerType.RSSecondary || this.isWritable;\n  }\n  /** Is this server data bearing */\n  get isDataBearing() {\n    return DATA_BEARING_SERVER_TYPES.has(this.type);\n  }\n  /** Is this server available for writes */\n  get isWritable() {\n    return WRITABLE_SERVER_TYPES.has(this.type);\n  }\n  get host() {\n    const chopLength = `:${this.port}`.length;\n    return this.address.slice(0, -chopLength);\n  }\n  get port() {\n    const port = this.address.split(':').pop();\n    return port ? Number.parseInt(port, 10) : 27017;\n  }\n  /**\n   * Determines if another `ServerDescription` is equal to this one per the rules defined\n   * in the {@link https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#serverdescription|SDAM spec}\n   */\n  equals(other) {\n    const topologyVersionsEqual = this.topologyVersion === other.topologyVersion || compareTopologyVersion(this.topologyVersion, other.topologyVersion) === 0;\n    const electionIdsEqual = this.electionId && other.electionId ? other.electionId && this.electionId.equals(other.electionId) : this.electionId === other.electionId;\n    return other != null && (0, utils_1.errorStrictEqual)(this.error, other.error) && this.type === other.type && this.minWireVersion === other.minWireVersion && (0, utils_1.arrayStrictEqual)(this.hosts, other.hosts) && tagsStrictEqual(this.tags, other.tags) && this.setName === other.setName && this.setVersion === other.setVersion && electionIdsEqual && this.primary === other.primary && this.logicalSessionTimeoutMinutes === other.logicalSessionTimeoutMinutes && topologyVersionsEqual;\n  }\n}\nexports.ServerDescription = ServerDescription;\n// Parses a `hello` message and determines the server type\nfunction parseServerType(hello, options) {\n  if (options === null || options === void 0 ? void 0 : options.loadBalanced) {\n    return common_1.ServerType.LoadBalancer;\n  }\n  if (!hello || !hello.ok) {\n    return common_1.ServerType.Unknown;\n  }\n  if (hello.isreplicaset) {\n    return common_1.ServerType.RSGhost;\n  }\n  if (hello.msg && hello.msg === 'isdbgrid') {\n    return common_1.ServerType.Mongos;\n  }\n  if (hello.setName) {\n    if (hello.hidden) {\n      return common_1.ServerType.RSOther;\n    } else if (hello.isWritablePrimary) {\n      return common_1.ServerType.RSPrimary;\n    } else if (hello.secondary) {\n      return common_1.ServerType.RSSecondary;\n    } else if (hello.arbiterOnly) {\n      return common_1.ServerType.RSArbiter;\n    } else {\n      return common_1.ServerType.RSOther;\n    }\n  }\n  return common_1.ServerType.Standalone;\n}\nexports.parseServerType = parseServerType;\nfunction tagsStrictEqual(tags, tags2) {\n  const tagsKeys = Object.keys(tags);\n  const tags2Keys = Object.keys(tags2);\n  return tagsKeys.length === tags2Keys.length && tagsKeys.every(key => tags2[key] === tags[key]);\n}\n/**\n * Compares two topology versions.\n *\n * @returns A negative number if `lhs` is older than `rhs`; positive if `lhs` is newer than `rhs`; 0 if they are equivalent.\n */\nfunction compareTopologyVersion(lhs, rhs) {\n  if (lhs == null || rhs == null) {\n    return -1;\n  }\n  if (lhs.processId.equals(rhs.processId)) {\n    // tests mock counter as just number, but in a real situation counter should always be a Long\n    const lhsCounter = bson_1.Long.isLong(lhs.counter) ? lhs.counter : bson_1.Long.fromNumber(lhs.counter);\n    const rhsCounter = bson_1.Long.isLong(rhs.counter) ? lhs.counter : bson_1.Long.fromNumber(rhs.counter);\n    return lhsCounter.compare(rhsCounter);\n  }\n  return -1;\n}\nexports.compareTopologyVersion = compareTopologyVersion;","map":{"version":3,"names":["bson_1","require","utils_1","common_1","WRITABLE_SERVER_TYPES","Set","ServerType","RSPrimary","Standalone","Mongos","LoadBalancer","DATA_BEARING_SERVER_TYPES","RSSecondary","ServerDescription","constructor","address","hello","options","_hostAddress","HostAddress","toString","type","parseServerType","hosts","_b","_a","map","host","toLowerCase","passives","_d","_c","arbiters","_f","_e","tags","_g","minWireVersion","_h","maxWireVersion","_j","roundTripTime","_k","lastUpdateTime","now","lastWriteDate","_m","_l","lastWrite","topologyVersion","error","primary","me","setName","setVersion","electionId","logicalSessionTimeoutMinutes","$clusterTime","hostAddress","allHosts","concat","isReadable","isWritable","isDataBearing","has","chopLength","port","length","slice","split","pop","Number","parseInt","equals","other","topologyVersionsEqual","compareTopologyVersion","electionIdsEqual","errorStrictEqual","arrayStrictEqual","tagsStrictEqual","exports","loadBalanced","ok","Unknown","isreplicaset","RSGhost","msg","hidden","RSOther","isWritablePrimary","secondary","arbiterOnly","RSArbiter","tags2","tagsKeys","Object","keys","tags2Keys","every","key","lhs","rhs","processId","lhsCounter","Long","isLong","counter","fromNumber","rhsCounter","compare"],"sources":["C:\\Users\\Jatin\\node_modules\\mongodb\\src\\sdam\\server_description.ts"],"sourcesContent":["import { Document, Long, ObjectId } from '../bson';\nimport type { MongoError } from '../error';\nimport { arrayStrictEqual, errorStrictEqual, HostAddress, now } from '../utils';\nimport type { ClusterTime } from './common';\nimport { ServerType } from './common';\n\nconst WRITABLE_SERVER_TYPES = new Set<ServerType>([\n  ServerType.RSPrimary,\n  ServerType.Standalone,\n  ServerType.Mongos,\n  ServerType.LoadBalancer\n]);\n\nconst DATA_BEARING_SERVER_TYPES = new Set<ServerType>([\n  ServerType.RSPrimary,\n  ServerType.RSSecondary,\n  ServerType.Mongos,\n  ServerType.Standalone,\n  ServerType.LoadBalancer\n]);\n\n/** @public */\nexport interface TopologyVersion {\n  processId: ObjectId;\n  counter: Long;\n}\n\n/** @public */\nexport type TagSet = { [key: string]: string };\n\n/** @internal */\nexport interface ServerDescriptionOptions {\n  /** An Error used for better reporting debugging */\n  error?: MongoError;\n\n  /** The round trip time to ping this server (in ms) */\n  roundTripTime?: number;\n\n  /** The topologyVersion */\n  topologyVersion?: TopologyVersion;\n\n  /** If the client is in load balancing mode. */\n  loadBalanced?: boolean;\n}\n\n/**\n * The client's view of a single server, based on the most recent hello outcome.\n *\n * Internal type, not meant to be directly instantiated\n * @public\n */\nexport class ServerDescription {\n  private _hostAddress: HostAddress;\n  address: string;\n  type: ServerType;\n  hosts: string[];\n  passives: string[];\n  arbiters: string[];\n  tags: TagSet;\n\n  error?: MongoError;\n  topologyVersion?: TopologyVersion;\n  minWireVersion: number;\n  maxWireVersion: number;\n  roundTripTime: number;\n  lastUpdateTime: number;\n  lastWriteDate: number;\n\n  me?: string;\n  primary?: string;\n  setName?: string;\n  setVersion?: number;\n  electionId?: ObjectId;\n  logicalSessionTimeoutMinutes?: number;\n\n  // NOTE: does this belong here? It seems we should gossip the cluster time at the CMAP level\n  $clusterTime?: ClusterTime;\n\n  /**\n   * Create a ServerDescription\n   * @internal\n   *\n   * @param address - The address of the server\n   * @param hello - An optional hello response for this server\n   */\n  constructor(address: HostAddress | string, hello?: Document, options?: ServerDescriptionOptions) {\n    if (typeof address === 'string') {\n      this._hostAddress = new HostAddress(address);\n      this.address = this._hostAddress.toString();\n    } else {\n      this._hostAddress = address;\n      this.address = this._hostAddress.toString();\n    }\n    this.type = parseServerType(hello, options);\n    this.hosts = hello?.hosts?.map((host: string) => host.toLowerCase()) ?? [];\n    this.passives = hello?.passives?.map((host: string) => host.toLowerCase()) ?? [];\n    this.arbiters = hello?.arbiters?.map((host: string) => host.toLowerCase()) ?? [];\n    this.tags = hello?.tags ?? {};\n    this.minWireVersion = hello?.minWireVersion ?? 0;\n    this.maxWireVersion = hello?.maxWireVersion ?? 0;\n    this.roundTripTime = options?.roundTripTime ?? -1;\n    this.lastUpdateTime = now();\n    this.lastWriteDate = hello?.lastWrite?.lastWriteDate ?? 0;\n\n    if (options?.topologyVersion) {\n      this.topologyVersion = options.topologyVersion;\n    } else if (hello?.topologyVersion) {\n      this.topologyVersion = hello.topologyVersion;\n    }\n\n    if (options?.error) {\n      this.error = options.error;\n    }\n\n    if (hello?.primary) {\n      this.primary = hello.primary;\n    }\n\n    if (hello?.me) {\n      this.me = hello.me.toLowerCase();\n    }\n\n    if (hello?.setName) {\n      this.setName = hello.setName;\n    }\n\n    if (hello?.setVersion) {\n      this.setVersion = hello.setVersion;\n    }\n\n    if (hello?.electionId) {\n      this.electionId = hello.electionId;\n    }\n\n    if (hello?.logicalSessionTimeoutMinutes) {\n      this.logicalSessionTimeoutMinutes = hello.logicalSessionTimeoutMinutes;\n    }\n\n    if (hello?.$clusterTime) {\n      this.$clusterTime = hello.$clusterTime;\n    }\n  }\n\n  get hostAddress(): HostAddress {\n    if (this._hostAddress) return this._hostAddress;\n    else return new HostAddress(this.address);\n  }\n\n  get allHosts(): string[] {\n    return this.hosts.concat(this.arbiters).concat(this.passives);\n  }\n\n  /** Is this server available for reads*/\n  get isReadable(): boolean {\n    return this.type === ServerType.RSSecondary || this.isWritable;\n  }\n\n  /** Is this server data bearing */\n  get isDataBearing(): boolean {\n    return DATA_BEARING_SERVER_TYPES.has(this.type);\n  }\n\n  /** Is this server available for writes */\n  get isWritable(): boolean {\n    return WRITABLE_SERVER_TYPES.has(this.type);\n  }\n\n  get host(): string {\n    const chopLength = `:${this.port}`.length;\n    return this.address.slice(0, -chopLength);\n  }\n\n  get port(): number {\n    const port = this.address.split(':').pop();\n    return port ? Number.parseInt(port, 10) : 27017;\n  }\n\n  /**\n   * Determines if another `ServerDescription` is equal to this one per the rules defined\n   * in the {@link https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#serverdescription|SDAM spec}\n   */\n  equals(other: ServerDescription): boolean {\n    const topologyVersionsEqual =\n      this.topologyVersion === other.topologyVersion ||\n      compareTopologyVersion(this.topologyVersion, other.topologyVersion) === 0;\n\n    const electionIdsEqual: boolean =\n      this.electionId && other.electionId\n        ? other.electionId && this.electionId.equals(other.electionId)\n        : this.electionId === other.electionId;\n\n    return (\n      other != null &&\n      errorStrictEqual(this.error, other.error) &&\n      this.type === other.type &&\n      this.minWireVersion === other.minWireVersion &&\n      arrayStrictEqual(this.hosts, other.hosts) &&\n      tagsStrictEqual(this.tags, other.tags) &&\n      this.setName === other.setName &&\n      this.setVersion === other.setVersion &&\n      electionIdsEqual &&\n      this.primary === other.primary &&\n      this.logicalSessionTimeoutMinutes === other.logicalSessionTimeoutMinutes &&\n      topologyVersionsEqual\n    );\n  }\n}\n\n// Parses a `hello` message and determines the server type\nexport function parseServerType(hello?: Document, options?: ServerDescriptionOptions): ServerType {\n  if (options?.loadBalanced) {\n    return ServerType.LoadBalancer;\n  }\n\n  if (!hello || !hello.ok) {\n    return ServerType.Unknown;\n  }\n\n  if (hello.isreplicaset) {\n    return ServerType.RSGhost;\n  }\n\n  if (hello.msg && hello.msg === 'isdbgrid') {\n    return ServerType.Mongos;\n  }\n\n  if (hello.setName) {\n    if (hello.hidden) {\n      return ServerType.RSOther;\n    } else if (hello.isWritablePrimary) {\n      return ServerType.RSPrimary;\n    } else if (hello.secondary) {\n      return ServerType.RSSecondary;\n    } else if (hello.arbiterOnly) {\n      return ServerType.RSArbiter;\n    } else {\n      return ServerType.RSOther;\n    }\n  }\n\n  return ServerType.Standalone;\n}\n\nfunction tagsStrictEqual(tags: TagSet, tags2: TagSet): boolean {\n  const tagsKeys = Object.keys(tags);\n  const tags2Keys = Object.keys(tags2);\n\n  return (\n    tagsKeys.length === tags2Keys.length &&\n    tagsKeys.every((key: string) => tags2[key] === tags[key])\n  );\n}\n\n/**\n * Compares two topology versions.\n *\n * @returns A negative number if `lhs` is older than `rhs`; positive if `lhs` is newer than `rhs`; 0 if they are equivalent.\n */\nexport function compareTopologyVersion(lhs?: TopologyVersion, rhs?: TopologyVersion): number {\n  if (lhs == null || rhs == null) {\n    return -1;\n  }\n\n  if (lhs.processId.equals(rhs.processId)) {\n    // tests mock counter as just number, but in a real situation counter should always be a Long\n    const lhsCounter = Long.isLong(lhs.counter) ? lhs.counter : Long.fromNumber(lhs.counter);\n    const rhsCounter = Long.isLong(rhs.counter) ? lhs.counter : Long.fromNumber(rhs.counter);\n    return lhsCounter.compare(rhsCounter);\n  }\n\n  return -1;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}